---
import Layout from "../../layouts/Layout.astro";
import FeedLayout from "../../components/feed-layout/feed-layout.jsx";

const { SANITY_STUDIO_PROJECT_ID, SANITY_STUDIO_PROJECT_DATASET, PAGINATION_SIZE } = import.meta.env
const pageSize = parseInt(PAGINATION_SIZE, 10)
const QUERY = encodeURIComponent('*[_type == "cheep"]{..., author->{"avatar": image.asset->url, ...}}');
const URL = `https://${SANITY_STUDIO_PROJECT_ID}.api.sanity.io/v2021-10-21/data/query/${SANITY_STUDIO_PROJECT_DATASET}?query=${QUERY}`;
const allCheeps = await (await (await fetch(URL)).json()).result

const page = {
  data: allCheeps.slice(0, pageSize),
  currentPage: 1,
  lastPage: Math.ceil(allCheeps.length / pageSize),
}
---
<Layout
  title="Jhey Tompkins"
  ogtitle="Posts from Jhey Tompkins"
  oggradient="2"
>
  <FeedLayout
    posts={page.data}
    currentPage={page.currentPage}
    totalPages={page.lastPage}
  />
</Layout>