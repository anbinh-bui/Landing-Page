---
import Layout from "../layouts/Layout.astro";
import FeedLayout from "../components/feed-layout/feed-layout.jsx";
import { getAllCheeps, getSiteConfig } from '../constants/queries.js'

const { PAGINATION_SIZE } = import.meta.env
const pageSize = parseInt(PAGINATION_SIZE, 10)

const allCheeps = await getAllCheeps()
const siteConfig = await getSiteConfig()

const page = {
  character: siteConfig[0].character,
  banner: siteConfig[0].banner,
  data: allCheeps.slice(0, pageSize),
  currentPage: 1,
  lastPage: Math.ceil(allCheeps.length / pageSize),
}
---

<Layout
  title="The feed"
  ogtitle="The feed of Jhey Tompkins"
  description="Thoughts and creations from the mind of Jhey Tompkins"
  oggradient="8"
>
  <FeedLayout
    banner={page.banner}
    character={page.character}
    posts={page.data}
    currentPage={page.currentPage}
    totalPages={page.lastPage}
  />
</Layout>